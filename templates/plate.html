<!doctype html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS: implied media="all"
  <link rel="stylesheet" href="css/style.css?v=2">
  -->
  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects
  <script src="js/libs/modernizr-1.7.min.js"></script>
  -->
</head>

<body>

  <div id="container">
    <header>

    </header>

    <div id="main" role="main">
        <input type="file" id="selected_file" name="selected_file" size="100"/>
        <button onclick="draw_raw()">Draw Raw</button>
        <button onclick="draw_avg()">Draw Avg</button>
        <button onclick="clear_canvas()">Clear</button>
        <input type="text" id="place_for_stats" size="100" />
        <br />
        <h1 id="title"></h1>
        <table id="output_table"></table>
        <canvas id="e" width="1200" height="800" style="float:right"></canvas>
    </div>

    <footer>

    </footer>
  </div> <!--! end of #container -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
<script>
var file_name_parts;
var data_area = $("#output_table");
function handleFileSelect(evt)
{
    data_area.empty();
    clear_canvas();
    var file = evt.target.files[0];
    var file_name = file.name.replace(".txt", "");
    file_name_parts = file_name.split("_");
    document.getElementById('title').innerHTML = file_name_parts[0] + " " + file_name_parts[2] + " " + file_name_parts[3]
    var reader = new FileReader();
    reader.onload = function(e){
        window.read_data(e.target.result);
    }
    reader.readAsText(file)
}
document.getElementById('selected_file').addEventListener('change', handleFileSelect, false);

function fill_table()
{
    var header1 = $("<tr><th>" + file_name_parts[0] + "</th><th>" + file_name_parts[1] + "</th><th>" + file_name_parts[2] + "</th><th>" + file_name_parts[3] + "</th></tr>");
    data_area.append(header1);
    var header2 = $("<tr><th>row</th><th>col</th><th>mean</th><th>sd</th></tr>");
    data_area.append(header2);
    for (var i in window.avgs) {
        for (var j in window.avgs[i]) {
            var stats = window.avgs[i][j];
            if (!stats || stats.n == 0)
                var tr = $("<tr><td>" + (Number(i)+1) + "</td><td>" + (Number(j)+1) + "</td><td></td><td></td></tr>");
            else
                var tr = $("<tr><td>" + (Number(i)+1) + "</td><td>" + (Number(j)+1) + "</td><td>" + stats.mean.toFixed(4) + "</td><td>" + stats.sd.toFixed(4) + "</td></tr>");
            data_area.append(tr);
        }
    }
}
</script>
<script src="/static/js/coffee-script.js"></script>
<script type="text/coffeescript" src="/static/js/stats.coffee"></script>
<script type="text/coffeescript" src="/static/js/platereader.coffee"></script>
</body>
</html>
